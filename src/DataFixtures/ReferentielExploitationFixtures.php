<?php

namespace App\DataFixtures;

use App\Entity\ReferentielExploitation;
use Doctrine\Bundle\FixturesBundle\Fixture;
use Doctrine\Common\DataFixtures\DependentFixtureInterface;
use Doctrine\Common\Persistence\ObjectManager;


class ReferentielExploitationFixtures extends AbstractFixtures
{
    private const FILENAME_REFERENTIEL = 'referentiel_exploitation.csv';

    public function load(ObjectManager $manager)
    {
        $row = 1;
        if (($handle = fopen( \getcwd() . "\src\DataFixtures\data\\" .  self::FILENAME_REFERENTIEL, "r")) !== FALSE) {
            while (($data = fgetcsv($handle, 1000, ",")) !== FALSE) {
                $dataRow = explode(";", $data[0]);
                $dataRow = $this->unquoteArray($dataRow);
                if ($row > 1) {

                    // original columns : TIPF;LIB;LIB AFFICHAGE EXTRANET;BASE
                    $referentielExploitation = new ReferentielExploitation();
                    $referentielExploitation->setCode($dataRow[0]);
                    $referentielExploitation->setLabel($dataRow[1]);
                    $referentielExploitation->setLabelExtranet($dataRow[2]);
                    $referentielExploitation->setDatabaseName($dataRow[3]);
                    $manager->persist($referentielExploitation);
                }
                $row++;
            }
            fclose($handle);
        }
        else {
            echo ("Cannot open file " . self::FILENAME_REFERENTIEL);
        }
        $manager->flush();
    }
}
