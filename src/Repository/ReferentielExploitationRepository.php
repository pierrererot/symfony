<?php

namespace App\Repository;

use App\Entity\ReferentielExploitation;
use Doctrine\Bundle\DoctrineBundle\Repository\ServiceEntityRepository;
use Symfony\Bridge\Doctrine\RegistryInterface;

class ReferentielExploitationRepository extends ServiceEntityRepository
{
    public function __construct(RegistryInterface $registry)
    {
        parent::__construct($registry, ReferentielExploitation::class);
    }

    public function findAllById()
    {
        return $this->findBy(array(), array('id' => 'ASC'));
    }

    /**
     * @param  $filter
     * @param array $order
     * @param $limit
     * @param $offset
     * @return ReferentielExploitation[]
     */
    public function search($filter, array $order, $limit=10, $offset=0)
    {
        $queryBuilder =  $this->createQueryBuilder('a')
            ->andWhere("lower(a.labelExtranet) LIKE :searchTerm");

        foreach ($order as $sort => $direction){
            $queryBuilder->addOrderBy("a.".$sort, $direction);
        }

        return $queryBuilder
            ->setParameter('searchTerm',strtolower('%'.$filter.'%'))
            ->setFirstResult($offset)
            ->setMaxResults($limit)
            ->getQuery()
            ->execute();
    }


}
